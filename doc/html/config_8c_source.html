<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>utcoupe2011: asserv2010/config.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>asserv2010/config.c</h1><a href="config_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="_a_l_types_8h.html">ALTypes.h</a>&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="config_8h.html">config.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;math.h&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="asserv_orientation_8h.html">asservOrientation.h</a>&quot;</span>
<a name="l00020"></a><a class="code" href="config_8c.html#a78db1a72334ee5f8aab8e960a4c792b9">00020</a> <span class="preprocessor">#define NB_JOINTS 2</span>
<a name="l00021"></a><a class="code" href="config_8c.html#aeba951631e83bfd8f0c464f8c35a5c95">00021</a> <span class="preprocessor"></span><a class="code" href="struct_joint_config.html">JointConfig</a> <a class="code" href="config_8c.html#aeba951631e83bfd8f0c464f8c35a5c95">joints</a>[<a class="code" href="config_8c.html#a78db1a72334ee5f8aab8e960a4c792b9">NB_JOINTS</a>]; <span class="comment">// 2 joints</span>
<a name="l00022"></a>00022 
<a name="l00023"></a><a class="code" href="config_8h.html#afd26fdfe7f8e112d2805849f5358b27f">00023</a> <a class="code" href="struct_joint_config.html">JointConfig</a> * <a class="code" href="config_8c.html#afd26fdfe7f8e112d2805849f5358b27f">oGetJointConfig</a>(<a class="code" href="_a_l_types_8h.html#a3b65128d2644e9b80cec9a69bfa7e094">uInt16</a> pJoint)
<a name="l00024"></a>00024 {
<a name="l00025"></a>00025     <span class="keywordflow">return</span> &amp;(joints[pJoint]);
<a name="l00026"></a>00026 }  
<a name="l00027"></a>00027 
<a name="l00031"></a><a class="code" href="config_8h.html#a8374cc689fdf02e60f74e948bb968363">00031</a> <span class="keywordtype">void</span> <a class="code" href="config_8c.html#a8374cc689fdf02e60f74e948bb968363">oInitConfig</a>(<span class="keywordtype">void</span>)
<a name="l00032"></a>00032 {
<a name="l00033"></a>00033     <span class="comment">//joints[0].motor.reductionRateMotor = 201.3;</span>
<a name="l00034"></a>00034     joints[0].<a class="code" href="struct_joint_config.html#a19be44a8da122af386c71da9a7c1747d">motor</a>.<a class="code" href="struct_joint_config.html#a6884aa6bfe2b9d21f058817463dd7096">InvertControlDirection</a> = 0;
<a name="l00035"></a>00035     joints[0].<a class="code" href="struct_joint_config.html#a19be44a8da122af386c71da9a7c1747d">motor</a>.<a class="code" href="struct_joint_config.html#af6d824d71a1cf988650d0277f3039e9c">motorPosition</a> = 1;
<a name="l00036"></a>00036     joints[0].<a class="code" href="struct_joint_config.html#a23d1828957ef9a6b862510999275687a">sensors</a>.<a class="code" href="struct_joint_config.html#ac924dc2db109da5029b358be2c3fec75">position</a> = 2;
<a name="l00037"></a>00037     joints[0].<a class="code" href="struct_joint_config.html#ac924dc2db109da5029b358be2c3fec75">position</a> = 0;
<a name="l00038"></a>00038     joints[0].<a class="code" href="struct_joint_config.html#a11ed95f40a458dd539ddfebc75959b24">lastPosition</a> = 0;
<a name="l00039"></a>00039     joints[0].<a class="code" href="struct_joint_config.html#a1a76e093b95a477700e2fd7a0721ae9f">speed</a> = 0;
<a name="l00040"></a>00040         
<a name="l00041"></a>00041     <span class="comment">//joints[1].motor.reductionRateMotor = 201.3;</span>
<a name="l00042"></a>00042     joints[1].<a class="code" href="struct_joint_config.html#a19be44a8da122af386c71da9a7c1747d">motor</a>.<a class="code" href="struct_joint_config.html#a6884aa6bfe2b9d21f058817463dd7096">InvertControlDirection</a> = 0;
<a name="l00043"></a>00043     joints[1].<a class="code" href="struct_joint_config.html#a19be44a8da122af386c71da9a7c1747d">motor</a>.<a class="code" href="struct_joint_config.html#af6d824d71a1cf988650d0277f3039e9c">motorPosition</a> = 2;
<a name="l00044"></a>00044     joints[1].<a class="code" href="struct_joint_config.html#a23d1828957ef9a6b862510999275687a">sensors</a>.<a class="code" href="struct_joint_config.html#ac924dc2db109da5029b358be2c3fec75">position</a> = 2;
<a name="l00045"></a>00045     joints[1].<a class="code" href="struct_joint_config.html#ac924dc2db109da5029b358be2c3fec75">position</a> = 0;
<a name="l00046"></a>00046     joints[1].<a class="code" href="struct_joint_config.html#a11ed95f40a458dd539ddfebc75959b24">lastPosition</a> = 0;
<a name="l00047"></a>00047     joints[1].<a class="code" href="struct_joint_config.html#a1a76e093b95a477700e2fd7a0721ae9f">speed</a> = 0;
<a name="l00048"></a>00048 }
<a name="l00049"></a>00049 
<a name="l00050"></a><a class="code" href="config_8c.html#a5cb06f0ed9ecd7a6820f1b170416f81a">00050</a> <a class="code" href="structrobot.html">robot</a> <a class="code" href="config_8c.html#a5cb06f0ed9ecd7a6820f1b170416f81a">ROBOT</a>;
<a name="l00051"></a><a class="code" href="config_8c.html#a579f1aec865cc117f44a053e363a7549">00051</a> <a class="code" href="structrobot.html">robot</a> <a class="code" href="config_8c.html#a579f1aec865cc117f44a053e363a7549">RobotLast</a>;
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="config_8h.html#a2f0c2c19c34d9311e70f16bab886a6f3">00053</a> <span class="keywordtype">void</span> <a class="code" href="config_8c.html#a2f0c2c19c34d9311e70f16bab886a6f3">updateLastRobot</a>(<span class="keywordtype">void</span>)
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055   RobotLast = ROBOT;
<a name="l00056"></a>00056 }
<a name="l00057"></a>00057 
<a name="l00058"></a><a class="code" href="config_8h.html#a2a3a4b17631927355bf220a65fc9d96b">00058</a> <span class="keywordtype">void</span> <a class="code" href="config_8c.html#a2a3a4b17631927355bf220a65fc9d96b">updateJoints</a>(<span class="keywordtype">void</span>)
<a name="l00059"></a>00059 {
<a name="l00060"></a>00060   joints[0].<a class="code" href="struct_joint_config.html#a11ed95f40a458dd539ddfebc75959b24">lastPosition</a> = joints[0].<a class="code" href="struct_joint_config.html#ac924dc2db109da5029b358be2c3fec75">position</a>;
<a name="l00061"></a>00061   joints[1].<a class="code" href="struct_joint_config.html#a11ed95f40a458dd539ddfebc75959b24">lastPosition</a> = joints[1].<a class="code" href="struct_joint_config.html#ac924dc2db109da5029b358be2c3fec75">position</a>;  
<a name="l00062"></a>00062 }
<a name="l00063"></a><a class="code" href="config_8h.html#a1620e709da932be9c3f2fff78ecf50e3">00063</a> <a class="code" href="structrobot.html">robot</a> * <a class="code" href="config_8c.html#a1620e709da932be9c3f2fff78ecf50e3">getRobot</a>(<span class="keywordtype">void</span>)
<a name="l00064"></a>00064 {
<a name="l00065"></a>00065   <span class="keywordflow">return</span> &amp;ROBOT;
<a name="l00066"></a>00066 } 
<a name="l00067"></a>00067 
<a name="l00068"></a><a class="code" href="config_8h.html#ad995c80b8e2bfe4f2b8dc4228fb493f0">00068</a> <a class="code" href="structrobot.html">robot</a> * <a class="code" href="config_8c.html#ad995c80b8e2bfe4f2b8dc4228fb493f0">getRobotLast</a>(<span class="keywordtype">void</span>)
<a name="l00069"></a>00069 {
<a name="l00070"></a>00070   <span class="keywordflow">return</span> &amp;ROBOT;
<a name="l00071"></a>00071 } 
<a name="l00072"></a>00072 
<a name="l00073"></a><a class="code" href="config_8h.html#ae896e514fc90ada138adb9662bc40077">00073</a> <span class="keywordtype">void</span> <a class="code" href="config_8c.html#ae896e514fc90ada138adb9662bc40077">initRobot</a>(<span class="keywordtype">void</span>)
<a name="l00074"></a>00074 {
<a name="l00075"></a>00075   ROBOT.<a class="code" href="structrobot.html#a5d839619db2bffea3a5ebbc12d7dd8d3">position</a>.<a class="code" href="structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>=0;
<a name="l00076"></a>00076   ROBOT.<a class="code" href="structrobot.html#a5d839619db2bffea3a5ebbc12d7dd8d3">position</a>.<a class="code" href="structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>=0;
<a name="l00077"></a>00077   ROBOT.<a class="code" href="structrobot.html#afb99e8bacc7d2d725332276f6a30625c">tx</a>=0;
<a name="l00078"></a>00078   ROBOT.<a class="code" href="structrobot.html#a33ac7fece30e948e841ef0626178e821">ty</a>=0;
<a name="l00079"></a>00079   ROBOT.<a class="code" href="structrobot.html#af44c2db40230064fd8239dfd1cca799c">speed</a>=0;
<a name="l00080"></a>00080 <span class="comment">//  ROBOT.acceleration=0.032;</span>
<a name="l00081"></a>00081   ROBOT.<a class="code" href="structrobot.html#ae2b19308c3681cbc09f35cec13c50d58">acceleration</a>=0.082;
<a name="l00082"></a>00082   ROBOT.<a class="code" href="structrobot.html#ad35f77fdbb109c792af47137a2ad5f74">decceleration</a>=-0.084;
<a name="l00083"></a>00083   ROBOT.<a class="code" href="structrobot.html#abc0768ef4ba84a1e5701fd071ffa9d6f">orientation</a>=0.0;
<a name="l00084"></a>00084   ROBOT.<a class="code" href="structrobot.html#a787011f82ee0b8d1c269f97d890410e4">orientation_initiale</a>= 0.0;
<a name="l00085"></a>00085   ROBOT.<a class="code" href="structrobot.html#a1a032a501f457b2b537b08ccc5e3af30">entraxe</a> = 5510; <span class="comment">// 5680 // was in 2008 : 7049.3</span>
<a name="l00086"></a>00086   ROBOT.<a class="code" href="structrobot.html#ae86408e7874d1ef673a57c10832d14e9">target</a> = ROBOT.<a class="code" href="structrobot.html#a5d839619db2bffea3a5ebbc12d7dd8d3">position</a>;
<a name="l00087"></a>00087   ROBOT.<a class="code" href="structrobot.html#a35a150ced7a4f6bf96b91549b761f4b7">nextTarget</a> = ROBOT.<a class="code" href="structrobot.html#ae86408e7874d1ef673a57c10832d14e9">target</a>;
<a name="l00088"></a>00088   ROBOT.<a class="code" href="structrobot.html#ac6fa501ce3a7ed6eb10a3ebf5283aed4">speedConsigne</a> = 0;
<a name="l00089"></a>00089   ROBOT.<a class="code" href="structrobot.html#abfa9412b2ff33905ffa70ea6d839eda7">speedMax</a> = 20;
<a name="l00090"></a>00090   ROBOT.<a class="code" href="structrobot.html#a0a7ff302376daa4ab84f6aa6c533181c">speedConsigneRot</a> = 0;
<a name="l00091"></a>00091   ROBOT.<a class="code" href="structrobot.html#ae793c7709db3862629798d9845ec15d8">speedRotMax</a> = (ROBOT.<a class="code" href="structrobot.html#abfa9412b2ff33905ffa70ea6d839eda7">speedMax</a> * <a class="code" href="_a_l_types_8h.html#a598a3330b3c21701223ee0ca14316eca">PI</a>)/(ROBOT.<a class="code" href="structrobot.html#a1a032a501f457b2b537b08ccc5e3af30">entraxe</a>);
<a name="l00092"></a>00092   ROBOT.<a class="code" href="structrobot.html#aa0a610505d0a33429e9f6c9f2a7f08c3">accelerationRot</a> = (ROBOT.<a class="code" href="structrobot.html#ae2b19308c3681cbc09f35cec13c50d58">acceleration</a> * <a class="code" href="_a_l_types_8h.html#a598a3330b3c21701223ee0ca14316eca">PI</a> )/( ROBOT.<a class="code" href="structrobot.html#a1a032a501f457b2b537b08ccc5e3af30">entraxe</a>);
<a name="l00093"></a>00093   <span class="comment">//ROBOT.speedConsigneRot = 0.009; </span>
<a name="l00094"></a>00094   ROBOT.<a class="code" href="structrobot.html#a4f3f020964f1c13e38678513aac86b73">rotationMode</a> = <a class="code" href="asserv_orientation_8h.html#a84a1435b09c7f8af9aafca7b941b0964">ROTATION_IN_PLACE</a>;
<a name="l00095"></a>00095   <a class="code" href="config_8c.html#a2f0c2c19c34d9311e70f16bab886a6f3">updateLastRobot</a>();
<a name="l00096"></a>00096 }
<a name="l00097"></a>00097 
<a name="l00098"></a><a class="code" href="config_8c.html#a028ff85d4be4b3e50f1c850ba57bef9f">00098</a> <a class="code" href="structasserv.html">asserv</a> <a class="code" href="class_p_i_d.html">PID</a>;
<a name="l00099"></a>00099 
<a name="l00100"></a><a class="code" href="config_8h.html#a5e71b7f680e74ecb24a5d99be79af082">00100</a> <span class="keywordtype">void</span> <a class="code" href="config_8c.html#a5e71b7f680e74ecb24a5d99be79af082">initPid</a>(<span class="keywordtype">void</span>)
<a name="l00101"></a>00101 {
<a name="l00102"></a>00102   PID.<a class="code" href="structasserv.html#aa6c642febf7ae10bfe380ba63453f963">Kp_d</a> = 64;
<a name="l00103"></a>00103   PID.<a class="code" href="structasserv.html#a93e5b5fc771c7a0877f0971a567c6f72">Ki_d</a> = 0;
<a name="l00104"></a>00104   PID.<a class="code" href="structasserv.html#afeb218cf07c1d67ddfb902d127c2633a">Kd_d</a> = 30;  
<a name="l00105"></a>00105   PID.<a class="code" href="structasserv.html#a4d1fc0910cb249ae5af8e4007ce71d76">Kp_o</a> = 131000;
<a name="l00106"></a>00106   PID.<a class="code" href="structasserv.html#a4206b0bbf2c1b60c44df113e37016c47">Ki_o</a> = 0; 
<a name="l00107"></a>00107   PID.<a class="code" href="structasserv.html#a0caee5d8e4b8082118617858791b2e1a">Kd_o</a> = 32;
<a name="l00108"></a>00108 }  
<a name="l00109"></a>00109 
<a name="l00110"></a><a class="code" href="config_8h.html#ada49cdfb49b464ff6eddc574ea087e72">00110</a> <a class="code" href="structasserv.html">asserv</a> * <a class="code" href="config_8c.html#ada49cdfb49b464ff6eddc574ea087e72">getPID</a>(<span class="keywordtype">void</span>)
<a name="l00111"></a>00111 {
<a name="l00112"></a>00112   <span class="keywordflow">return</span> &amp;PID;
<a name="l00113"></a>00113 }
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 
<a name="l00116"></a><a class="code" href="config_8h.html#ab1f5d29f4f72309b0f218578650bb330">00116</a> <span class="keywordtype">float</span> <a class="code" href="config_8c.html#ab1f5d29f4f72309b0f218578650bb330">toMillimeter</a>(<span class="keywordtype">float</span> pDistance)
<a name="l00117"></a>00117 {
<a name="l00118"></a>00118   <span class="keywordflow">return</span> pDistance/<a class="code" href="config_8h.html#acacca3b69daf2bb5962520d6c2ec747e">COUNT_MILLIMETER</a>;
<a name="l00119"></a>00119 }
<a name="l00120"></a>00120 
<a name="l00121"></a><a class="code" href="config_8h.html#a511465638abac4418bc774d5d36b6ad4">00121</a> <span class="keywordtype">float</span> <a class="code" href="config_8c.html#a511465638abac4418bc774d5d36b6ad4">toCount</a>(<span class="keywordtype">float</span> pDistance)
<a name="l00122"></a>00122 {
<a name="l00123"></a>00123   <span class="keywordflow">return</span> pDistance*<a class="code" href="config_8h.html#acacca3b69daf2bb5962520d6c2ec747e">COUNT_MILLIMETER</a>;
<a name="l00124"></a>00124 }
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Wed Jan 26 14:33:06 2011 for utcoupe2011 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
